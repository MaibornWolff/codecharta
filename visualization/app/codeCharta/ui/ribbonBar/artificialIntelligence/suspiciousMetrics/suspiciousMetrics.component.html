<button [matMenuTriggerFor]="menu" title="Open Suspicious Metrics Panel" class="cc-ribbon-bar-menu-button" (click)="hideBadge = true">
	<i class="fa fa-exclamation-triangle"></i>
	<span
		class="suspicious-metrics-badge"
		*ngIf="
			!hideBadge &&
			(data.analyzedProgrammingLanguage !== undefined ||
				data.suspiciousMetricSuggestionLinks.length ||
				data.unsuspiciousMetrics.length)
		"
	>
		{{ data.suspiciousMetricSuggestionLinks.length }}
	</span>
</button>

<mat-menu #menu="matMenu" class="ai-drop-down suspicious-metric-panel">
	<div (click)="$event.stopPropagation()">
		<div class="suspicious-metric-title">
			<div>
				Suspicious Metrics
				<button
					title="Open Information about Suspicious Metrics"
					popovertarget="suspiciousMetricPopover"
					mat-icon-button
					(click)="togglePopup()"
				>
					<i matSuffix class="fa fa-info-circle suspicious-metric-info-button"></i>
				</button>
			</div>
		</div>
		<div
			id="suspiciousMetricPopover"
			data-testid="suspiciousMetricPopover"
			*ngIf="showSuspiciousMetricInfo"
			class="suspicious-metric-info-text"
		>
			This feature compares the values of certain metrics from the loaded cc.json file with metric values of 241 Open Source Java
			projects. Based on this data suspicious and inconspicuous metrics are identified and corresponding suggestions can be clicked to
			view them. Be aware that metrics for other programming languages might not be comparable to Java Reference metric values. More
			information can be found here:
			<a href="https://maibornwolff.github.io/codecharta/docs/suspicious-metrics/">link</a> to How-To article.
		</div>
		<div class="title" *ngIf="data.unsuspiciousMetrics.length">
			{{
				data.analyzedProgrammingLanguage?.length
					? "Unsuspicious Metrics in " + data.analyzedProgrammingLanguage + " code"
					: "Unsuspicious Metrics"
			}}
		</div>
		<ul>
			<li *ngFor="let unsuspiciousMetric of data.unsuspiciousMetrics">{{ unsuspiciousMetric }}</li>
		</ul>
		<div *ngIf="data.suspiciousMetricSuggestionLinks.length" class="title new-section">
			Suspicious Metrics in {{ data.analyzedProgrammingLanguage }} code
		</div>
		<div class="suspicious-metric" *ngFor="let item of data.suspiciousMetricSuggestionLinks">
			<button
				class="metric-button"
				(click)="applySuspiciousMetric(item, false)"
				title="Apply Map Configuration to show files with suspicious metric {{
					item.metric
				}} and high risk or very high risk depending on selection"
			>
				{{ getNameAndDescriptionOfMetric(item.metric) }}
			</button>

			<button
				*ngIf="item.isOutlier"
				class="risk-button"
				(click)="applySuspiciousMetric(item, true)"
				title="Show very high risk files (90th percentile)"
			>
				Highlight Outliers
				<i class="fa fa-exclamation-triangle"></i>
			</button>
		</div>

		<div *ngIf="data.untrackedMetrics.length">
			<div *ngIf="data.analyzedProgrammingLanguage.length" class="title">
				<button data-testid="Untracked Metrics" class="untracked-metrics-button" (click)="toggleMetricsVisibility()">
					Untracked metrics in {{ data.analyzedProgrammingLanguage }} code
					<i class="fa fa-caret-down untracked-metrics-icon"></i>
				</button>
			</div>
			<ul data-testid="List of Untracked Metrics in ts Code" *ngIf="isUntrackedMetricsVisible">
				<li *ngFor="let untrackedMetric of data.untrackedMetrics">{{ untrackedMetric }}</li>
			</ul>
			<div *ngIf="data.analyzedProgrammingLanguage === undefined">
				No programming language was found for analyzing suspicious metrics.
			</div>
		</div>
	</div>
</mat-menu>
